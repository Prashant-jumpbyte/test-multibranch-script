pipeline {
  agent any
        tools {nodejs "NodeJS"}
  stages {
    stage('Init Project') {
      steps {
      # Node Version Manager with Jenkins
      # https://github.com/creationix/nvm , https://www.sitepoint.com/quick-tip-multiple-versions-node-nvm/
      set +ex                     # immediate script fail off, echo off
      export NVM_DIR="$HOME/.nvm" # set local path to NVM
      . ~/.nvm/nvm.sh             # add NVM into the Shell session
      nvm install v6.9.1          # first time only
      nvm use v6.9.1              # choose current version
      set -ex 
      }
    }
       
    stage('Install dependencies') {
      steps {
        sh 'npm install'
      }
    }
     
    stage('Test') {
      steps {
         sh 'npm test'
      }
    }      
  }
}
